{"ast":null,"code":"import { Factory } from '../Factory.js';\nimport { Node } from '../Node.js';\nimport { getNumberValidator } from '../Validators.js';\n\nfunction pixelAt(idata, x, y) {\n  var idx = (y * idata.width + x) * 4;\n  var d = [];\n  d.push(idata.data[idx++], idata.data[idx++], idata.data[idx++], idata.data[idx++]);\n  return d;\n}\n\nfunction rgbDistance(p1, p2) {\n  return Math.sqrt(Math.pow(p1[0] - p2[0], 2) + Math.pow(p1[1] - p2[1], 2) + Math.pow(p1[2] - p2[2], 2));\n}\n\nfunction rgbMean(pTab) {\n  var m = [0, 0, 0];\n\n  for (var i = 0; i < pTab.length; i++) {\n    m[0] += pTab[i][0];\n    m[1] += pTab[i][1];\n    m[2] += pTab[i][2];\n  }\n\n  m[0] /= pTab.length;\n  m[1] /= pTab.length;\n  m[2] /= pTab.length;\n  return m;\n}\n\nfunction backgroundMask(idata, threshold) {\n  var rgbv_no = pixelAt(idata, 0, 0);\n  var rgbv_ne = pixelAt(idata, idata.width - 1, 0);\n  var rgbv_so = pixelAt(idata, 0, idata.height - 1);\n  var rgbv_se = pixelAt(idata, idata.width - 1, idata.height - 1);\n  var thres = threshold || 10;\n\n  if (rgbDistance(rgbv_no, rgbv_ne) < thres && rgbDistance(rgbv_ne, rgbv_se) < thres && rgbDistance(rgbv_se, rgbv_so) < thres && rgbDistance(rgbv_so, rgbv_no) < thres) {\n    var mean = rgbMean([rgbv_ne, rgbv_no, rgbv_se, rgbv_so]);\n    var mask = [];\n\n    for (var i = 0; i < idata.width * idata.height; i++) {\n      var d = rgbDistance(mean, [idata.data[i * 4], idata.data[i * 4 + 1], idata.data[i * 4 + 2]]);\n      mask[i] = d < thres ? 0 : 255;\n    }\n\n    return mask;\n  }\n}\n\nfunction applyMask(idata, mask) {\n  for (var i = 0; i < idata.width * idata.height; i++) {\n    idata.data[4 * i + 3] = mask[i];\n  }\n}\n\nfunction erodeMask(mask, sw, sh) {\n  var weights = [1, 1, 1, 1, 0, 1, 1, 1, 1];\n  var side = Math.round(Math.sqrt(weights.length));\n  var halfSide = Math.floor(side / 2);\n  var maskResult = [];\n\n  for (var y = 0; y < sh; y++) {\n    for (var x = 0; x < sw; x++) {\n      var so = y * sw + x;\n      var a = 0;\n\n      for (var cy = 0; cy < side; cy++) {\n        for (var cx = 0; cx < side; cx++) {\n          var scy = y + cy - halfSide;\n          var scx = x + cx - halfSide;\n\n          if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {\n            var srcOff = scy * sw + scx;\n            var wt = weights[cy * side + cx];\n            a += mask[srcOff] * wt;\n          }\n        }\n      }\n\n      maskResult[so] = a === 255 * 8 ? 255 : 0;\n    }\n  }\n\n  return maskResult;\n}\n\nfunction dilateMask(mask, sw, sh) {\n  var weights = [1, 1, 1, 1, 1, 1, 1, 1, 1];\n  var side = Math.round(Math.sqrt(weights.length));\n  var halfSide = Math.floor(side / 2);\n  var maskResult = [];\n\n  for (var y = 0; y < sh; y++) {\n    for (var x = 0; x < sw; x++) {\n      var so = y * sw + x;\n      var a = 0;\n\n      for (var cy = 0; cy < side; cy++) {\n        for (var cx = 0; cx < side; cx++) {\n          var scy = y + cy - halfSide;\n          var scx = x + cx - halfSide;\n\n          if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {\n            var srcOff = scy * sw + scx;\n            var wt = weights[cy * side + cx];\n            a += mask[srcOff] * wt;\n          }\n        }\n      }\n\n      maskResult[so] = a >= 255 * 4 ? 255 : 0;\n    }\n  }\n\n  return maskResult;\n}\n\nfunction smoothEdgeMask(mask, sw, sh) {\n  var weights = [1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9];\n  var side = Math.round(Math.sqrt(weights.length));\n  var halfSide = Math.floor(side / 2);\n  var maskResult = [];\n\n  for (var y = 0; y < sh; y++) {\n    for (var x = 0; x < sw; x++) {\n      var so = y * sw + x;\n      var a = 0;\n\n      for (var cy = 0; cy < side; cy++) {\n        for (var cx = 0; cx < side; cx++) {\n          var scy = y + cy - halfSide;\n          var scx = x + cx - halfSide;\n\n          if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {\n            var srcOff = scy * sw + scx;\n            var wt = weights[cy * side + cx];\n            a += mask[srcOff] * wt;\n          }\n        }\n      }\n\n      maskResult[so] = a;\n    }\n  }\n\n  return maskResult;\n}\n\nexport const Mask = function (imageData) {\n  var threshold = this.threshold(),\n      mask = backgroundMask(imageData, threshold);\n\n  if (mask) {\n    mask = erodeMask(mask, imageData.width, imageData.height);\n    mask = dilateMask(mask, imageData.width, imageData.height);\n    mask = smoothEdgeMask(mask, imageData.width, imageData.height);\n    applyMask(imageData, mask);\n  }\n\n  return imageData;\n};\nFactory.addGetterSetter(Node, 'threshold', 0, getNumberValidator(), Factory.afterSetFilter);","map":{"version":3,"names":["Factory","Node","getNumberValidator","pixelAt","idata","x","y","idx","width","d","push","data","rgbDistance","p1","p2","Math","sqrt","pow","rgbMean","pTab","m","i","length","backgroundMask","threshold","rgbv_no","rgbv_ne","rgbv_so","height","rgbv_se","thres","mean","mask","applyMask","erodeMask","sw","sh","weights","side","round","halfSide","floor","maskResult","so","a","cy","cx","scy","scx","srcOff","wt","dilateMask","smoothEdgeMask","Mask","imageData","addGetterSetter","afterSetFilter"],"sources":["C:/traffic_sim/traffic-sim/sim_ui/node_modules/konva/lib/filters/Mask.js"],"sourcesContent":["import { Factory } from '../Factory.js';\nimport { Node } from '../Node.js';\nimport { getNumberValidator } from '../Validators.js';\nfunction pixelAt(idata, x, y) {\n    var idx = (y * idata.width + x) * 4;\n    var d = [];\n    d.push(idata.data[idx++], idata.data[idx++], idata.data[idx++], idata.data[idx++]);\n    return d;\n}\nfunction rgbDistance(p1, p2) {\n    return Math.sqrt(Math.pow(p1[0] - p2[0], 2) +\n        Math.pow(p1[1] - p2[1], 2) +\n        Math.pow(p1[2] - p2[2], 2));\n}\nfunction rgbMean(pTab) {\n    var m = [0, 0, 0];\n    for (var i = 0; i < pTab.length; i++) {\n        m[0] += pTab[i][0];\n        m[1] += pTab[i][1];\n        m[2] += pTab[i][2];\n    }\n    m[0] /= pTab.length;\n    m[1] /= pTab.length;\n    m[2] /= pTab.length;\n    return m;\n}\nfunction backgroundMask(idata, threshold) {\n    var rgbv_no = pixelAt(idata, 0, 0);\n    var rgbv_ne = pixelAt(idata, idata.width - 1, 0);\n    var rgbv_so = pixelAt(idata, 0, idata.height - 1);\n    var rgbv_se = pixelAt(idata, idata.width - 1, idata.height - 1);\n    var thres = threshold || 10;\n    if (rgbDistance(rgbv_no, rgbv_ne) < thres &&\n        rgbDistance(rgbv_ne, rgbv_se) < thres &&\n        rgbDistance(rgbv_se, rgbv_so) < thres &&\n        rgbDistance(rgbv_so, rgbv_no) < thres) {\n        var mean = rgbMean([rgbv_ne, rgbv_no, rgbv_se, rgbv_so]);\n        var mask = [];\n        for (var i = 0; i < idata.width * idata.height; i++) {\n            var d = rgbDistance(mean, [\n                idata.data[i * 4],\n                idata.data[i * 4 + 1],\n                idata.data[i * 4 + 2],\n            ]);\n            mask[i] = d < thres ? 0 : 255;\n        }\n        return mask;\n    }\n}\nfunction applyMask(idata, mask) {\n    for (var i = 0; i < idata.width * idata.height; i++) {\n        idata.data[4 * i + 3] = mask[i];\n    }\n}\nfunction erodeMask(mask, sw, sh) {\n    var weights = [1, 1, 1, 1, 0, 1, 1, 1, 1];\n    var side = Math.round(Math.sqrt(weights.length));\n    var halfSide = Math.floor(side / 2);\n    var maskResult = [];\n    for (var y = 0; y < sh; y++) {\n        for (var x = 0; x < sw; x++) {\n            var so = y * sw + x;\n            var a = 0;\n            for (var cy = 0; cy < side; cy++) {\n                for (var cx = 0; cx < side; cx++) {\n                    var scy = y + cy - halfSide;\n                    var scx = x + cx - halfSide;\n                    if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {\n                        var srcOff = scy * sw + scx;\n                        var wt = weights[cy * side + cx];\n                        a += mask[srcOff] * wt;\n                    }\n                }\n            }\n            maskResult[so] = a === 255 * 8 ? 255 : 0;\n        }\n    }\n    return maskResult;\n}\nfunction dilateMask(mask, sw, sh) {\n    var weights = [1, 1, 1, 1, 1, 1, 1, 1, 1];\n    var side = Math.round(Math.sqrt(weights.length));\n    var halfSide = Math.floor(side / 2);\n    var maskResult = [];\n    for (var y = 0; y < sh; y++) {\n        for (var x = 0; x < sw; x++) {\n            var so = y * sw + x;\n            var a = 0;\n            for (var cy = 0; cy < side; cy++) {\n                for (var cx = 0; cx < side; cx++) {\n                    var scy = y + cy - halfSide;\n                    var scx = x + cx - halfSide;\n                    if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {\n                        var srcOff = scy * sw + scx;\n                        var wt = weights[cy * side + cx];\n                        a += mask[srcOff] * wt;\n                    }\n                }\n            }\n            maskResult[so] = a >= 255 * 4 ? 255 : 0;\n        }\n    }\n    return maskResult;\n}\nfunction smoothEdgeMask(mask, sw, sh) {\n    var weights = [1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9, 1 / 9];\n    var side = Math.round(Math.sqrt(weights.length));\n    var halfSide = Math.floor(side / 2);\n    var maskResult = [];\n    for (var y = 0; y < sh; y++) {\n        for (var x = 0; x < sw; x++) {\n            var so = y * sw + x;\n            var a = 0;\n            for (var cy = 0; cy < side; cy++) {\n                for (var cx = 0; cx < side; cx++) {\n                    var scy = y + cy - halfSide;\n                    var scx = x + cx - halfSide;\n                    if (scy >= 0 && scy < sh && scx >= 0 && scx < sw) {\n                        var srcOff = scy * sw + scx;\n                        var wt = weights[cy * side + cx];\n                        a += mask[srcOff] * wt;\n                    }\n                }\n            }\n            maskResult[so] = a;\n        }\n    }\n    return maskResult;\n}\nexport const Mask = function (imageData) {\n    var threshold = this.threshold(), mask = backgroundMask(imageData, threshold);\n    if (mask) {\n        mask = erodeMask(mask, imageData.width, imageData.height);\n        mask = dilateMask(mask, imageData.width, imageData.height);\n        mask = smoothEdgeMask(mask, imageData.width, imageData.height);\n        applyMask(imageData, mask);\n    }\n    return imageData;\n};\nFactory.addGetterSetter(Node, 'threshold', 0, getNumberValidator(), Factory.afterSetFilter);\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}