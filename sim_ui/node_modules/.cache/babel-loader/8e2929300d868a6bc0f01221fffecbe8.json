{"ast":null,"code":"import { Konva } from './Global.js';\nimport { Util } from './Util.js';\nexport const DD = {\n  get isDragging() {\n    var flag = false;\n\n    DD._dragElements.forEach(elem => {\n      if (elem.dragStatus === 'dragging') {\n        flag = true;\n      }\n    });\n\n    return flag;\n  },\n\n  justDragged: false,\n\n  get node() {\n    var node;\n\n    DD._dragElements.forEach(elem => {\n      node = elem.node;\n    });\n\n    return node;\n  },\n\n  _dragElements: new Map(),\n\n  _drag(evt) {\n    const nodesToFireEvents = [];\n\n    DD._dragElements.forEach((elem, key) => {\n      const {\n        node\n      } = elem;\n      const stage = node.getStage();\n      stage.setPointersPositions(evt);\n\n      if (elem.pointerId === undefined) {\n        elem.pointerId = Util._getFirstPointerId(evt);\n      }\n\n      const pos = stage._changedPointerPositions.find(pos => pos.id === elem.pointerId);\n\n      if (!pos) {\n        return;\n      }\n\n      if (elem.dragStatus !== 'dragging') {\n        var dragDistance = node.dragDistance();\n        var distance = Math.max(Math.abs(pos.x - elem.startPointerPos.x), Math.abs(pos.y - elem.startPointerPos.y));\n\n        if (distance < dragDistance) {\n          return;\n        }\n\n        node.startDrag({\n          evt\n        });\n\n        if (!node.isDragging()) {\n          return;\n        }\n      }\n\n      node._setDragPosition(evt, elem);\n\n      nodesToFireEvents.push(node);\n    });\n\n    nodesToFireEvents.forEach(node => {\n      node.fire('dragmove', {\n        type: 'dragmove',\n        target: node,\n        evt: evt\n      }, true);\n    });\n  },\n\n  _endDragBefore(evt) {\n    const drawNodes = [];\n\n    DD._dragElements.forEach(elem => {\n      const {\n        node\n      } = elem;\n      const stage = node.getStage();\n\n      if (evt) {\n        stage.setPointersPositions(evt);\n      }\n\n      const pos = stage._changedPointerPositions.find(pos => pos.id === elem.pointerId);\n\n      if (!pos) {\n        return;\n      }\n\n      if (elem.dragStatus === 'dragging' || elem.dragStatus === 'stopped') {\n        DD.justDragged = true;\n        Konva._mouseListenClick = false;\n        Konva._touchListenClick = false;\n        Konva._pointerListenClick = false;\n        elem.dragStatus = 'stopped';\n      }\n\n      const drawNode = elem.node.getLayer() || elem.node instanceof Konva['Stage'] && elem.node;\n\n      if (drawNode && drawNodes.indexOf(drawNode) === -1) {\n        drawNodes.push(drawNode);\n      }\n    });\n\n    drawNodes.forEach(drawNode => {\n      drawNode.draw();\n    });\n  },\n\n  _endDragAfter(evt) {\n    DD._dragElements.forEach((elem, key) => {\n      if (elem.dragStatus === 'stopped') {\n        elem.node.fire('dragend', {\n          type: 'dragend',\n          target: elem.node,\n          evt: evt\n        }, true);\n      }\n\n      if (elem.dragStatus !== 'dragging') {\n        DD._dragElements.delete(key);\n      }\n    });\n  }\n\n};\n\nif (Konva.isBrowser) {\n  window.addEventListener('mouseup', DD._endDragBefore, true);\n  window.addEventListener('touchend', DD._endDragBefore, true);\n  window.addEventListener('mousemove', DD._drag);\n  window.addEventListener('touchmove', DD._drag);\n  window.addEventListener('mouseup', DD._endDragAfter, false);\n  window.addEventListener('touchend', DD._endDragAfter, false);\n}","map":{"version":3,"names":["Konva","Util","DD","isDragging","flag","_dragElements","forEach","elem","dragStatus","justDragged","node","Map","_drag","evt","nodesToFireEvents","key","stage","getStage","setPointersPositions","pointerId","undefined","_getFirstPointerId","pos","_changedPointerPositions","find","id","dragDistance","distance","Math","max","abs","x","startPointerPos","y","startDrag","_setDragPosition","push","fire","type","target","_endDragBefore","drawNodes","_mouseListenClick","_touchListenClick","_pointerListenClick","drawNode","getLayer","indexOf","draw","_endDragAfter","delete","isBrowser","window","addEventListener"],"sources":["C:/traffic_sim/traffic-sim/sim_ui/node_modules/konva/lib/DragAndDrop.js"],"sourcesContent":["import { Konva } from './Global.js';\nimport { Util } from './Util.js';\nexport const DD = {\n    get isDragging() {\n        var flag = false;\n        DD._dragElements.forEach((elem) => {\n            if (elem.dragStatus === 'dragging') {\n                flag = true;\n            }\n        });\n        return flag;\n    },\n    justDragged: false,\n    get node() {\n        var node;\n        DD._dragElements.forEach((elem) => {\n            node = elem.node;\n        });\n        return node;\n    },\n    _dragElements: new Map(),\n    _drag(evt) {\n        const nodesToFireEvents = [];\n        DD._dragElements.forEach((elem, key) => {\n            const { node } = elem;\n            const stage = node.getStage();\n            stage.setPointersPositions(evt);\n            if (elem.pointerId === undefined) {\n                elem.pointerId = Util._getFirstPointerId(evt);\n            }\n            const pos = stage._changedPointerPositions.find((pos) => pos.id === elem.pointerId);\n            if (!pos) {\n                return;\n            }\n            if (elem.dragStatus !== 'dragging') {\n                var dragDistance = node.dragDistance();\n                var distance = Math.max(Math.abs(pos.x - elem.startPointerPos.x), Math.abs(pos.y - elem.startPointerPos.y));\n                if (distance < dragDistance) {\n                    return;\n                }\n                node.startDrag({ evt });\n                if (!node.isDragging()) {\n                    return;\n                }\n            }\n            node._setDragPosition(evt, elem);\n            nodesToFireEvents.push(node);\n        });\n        nodesToFireEvents.forEach((node) => {\n            node.fire('dragmove', {\n                type: 'dragmove',\n                target: node,\n                evt: evt,\n            }, true);\n        });\n    },\n    _endDragBefore(evt) {\n        const drawNodes = [];\n        DD._dragElements.forEach((elem) => {\n            const { node } = elem;\n            const stage = node.getStage();\n            if (evt) {\n                stage.setPointersPositions(evt);\n            }\n            const pos = stage._changedPointerPositions.find((pos) => pos.id === elem.pointerId);\n            if (!pos) {\n                return;\n            }\n            if (elem.dragStatus === 'dragging' || elem.dragStatus === 'stopped') {\n                DD.justDragged = true;\n                Konva._mouseListenClick = false;\n                Konva._touchListenClick = false;\n                Konva._pointerListenClick = false;\n                elem.dragStatus = 'stopped';\n            }\n            const drawNode = elem.node.getLayer() ||\n                (elem.node instanceof Konva['Stage'] && elem.node);\n            if (drawNode && drawNodes.indexOf(drawNode) === -1) {\n                drawNodes.push(drawNode);\n            }\n        });\n        drawNodes.forEach((drawNode) => {\n            drawNode.draw();\n        });\n    },\n    _endDragAfter(evt) {\n        DD._dragElements.forEach((elem, key) => {\n            if (elem.dragStatus === 'stopped') {\n                elem.node.fire('dragend', {\n                    type: 'dragend',\n                    target: elem.node,\n                    evt: evt,\n                }, true);\n            }\n            if (elem.dragStatus !== 'dragging') {\n                DD._dragElements.delete(key);\n            }\n        });\n    },\n};\nif (Konva.isBrowser) {\n    window.addEventListener('mouseup', DD._endDragBefore, true);\n    window.addEventListener('touchend', DD._endDragBefore, true);\n    window.addEventListener('mousemove', DD._drag);\n    window.addEventListener('touchmove', DD._drag);\n    window.addEventListener('mouseup', DD._endDragAfter, false);\n    window.addEventListener('touchend', DD._endDragAfter, false);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}